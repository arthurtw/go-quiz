!function(t,i){"use strict";var e=document.getElementsByTagName("script"),s=e[e.length-1].src.split("?")[0],n=s.split("/").slice(0,-1).join("/")+"/",r={version:"2.0",B:1,W:-1,ERROR_REPORT:!0,DIR:n,lang:"en",i18n:{en:{}}};r.opera=-1!=navigator.userAgent.search(/(opera)(?:.*version)?[ \/]([\w.]+)/i),r.webkit=-1!=navigator.userAgent.search(/(webkit)[ \/]([\w.]+)/i),r.msie=-1!=navigator.userAgent.search(/(msie) ([\w.]+)/i),r.mozilla=-1!=navigator.userAgent.search(/(mozilla)(?:.*? rv:([\w.]+))?/i)&&!r.webkit&&!r.msie,r.t=function(t){var i=r.i18n[r.lang][t]||r.i18n.en[t];if(i){for(var e=1;e<arguments.length;e++)i=i.replace("$",arguments[e]);return i}return t},r.extendClass=function(t,i){return i.prototype=Object.create(t.prototype),i.prototype.constructor=i,i.prototype["super"]=t,i},r.abstractMethod=function(){throw Error("unimplemented abstract method")},r.clone=function(t){if(t&&"object"==typeof t){var i=t.constructor==Array?[]:{};for(var e in t)i[e]=t[e]==t?t:r.clone(t[e]);return i}return t},r.filterHTML=function(t){return t&&"string"==typeof t?t.replace("<","&lt;").replace(">","&gt;"):t};var o=function(t,e){var e=e||{};for(var s in e)this[s]=e[s];for(var s in r.Board["default"])this[s]===i&&(this[s]=r.Board["default"][s]);this.tx=this.section.left,this.ty=this.section.top,this.bx=this.size-1-this.section.right,this.by=this.size-1-this.section.bottom,this.init(),t.appendChild(this.element),this.width&&this.height?this.setDimensions(this.width,this.height):this.width?this.setWidth(this.width):this.height&&this.setHeight(this.height)},h={draw:function(t,i){var e=i.getX(t.x),s=i.getY(t.y),n=i.stoneRadius;this.beginPath(),this.fillStyle="rgba(32,32,32,0.5)",this.arc(e-.5,s-.5,n-.5,0,2*Math.PI,!0),this.fill()}},a=function(t,i,e){return t.obj_arr[i][e][0].c==r.B?"white":"black"},c=function(t,i){var e;t[i].clear(),t[i].draw(t);for(var s=0;s<t.size;s++)for(var n=0;n<t.size;n++)for(var r in t.obj_arr[s][n])e=t.obj_arr[s][n][r].type?"string"==typeof t.obj_arr[s][n][r].type?o.drawHandlers[t.obj_arr[s][n][r].type]:t.obj_arr[s][n][r].type:t.stoneHandler,e[i]&&e[i].draw.call(t[i].context,t.obj_arr[s][n][r],t);for(var r in t.obj_list){var e=t.obj_list[r].handler;e[i]&&e[i].draw.call(t[i].context,t.obj_list[r].args,t)}};o.drawHandlers={NORMAL:{stone:{draw:function(t,i){var e,s=i.getX(t.x),n=i.getY(t.y),o=i.stoneRadius;t.c==r.W?(e=this.createRadialGradient(s-2*o/5,n-2*o/5,o/3,s-o/5,n-o/5,5*o/5),e.addColorStop(0,"#fff"),e.addColorStop(1,"#aaa")):(e=this.createRadialGradient(s-2*o/5,n-2*o/5,1,s-o/5,n-o/5,4*o/5),e.addColorStop(0,"#666"),e.addColorStop(1,"#000")),this.beginPath(),this.fillStyle=e,this.arc(s-.5,n-.5,o-.5,0,2*Math.PI,!0),this.fill()}},shadow:h},PAINTED:{stone:{draw:function(t,i){var e,s=i.getX(t.x),n=i.getY(t.y),o=i.stoneRadius;t.c==r.W?(e=this.createRadialGradient(s-2*o/5,n-2*o/5,2,s-o/5,n-o/5,4*o/5),e.addColorStop(0,"#fff"),e.addColorStop(1,"#ddd")):(e=this.createRadialGradient(s-2*o/5,n-2*o/5,1,s-o/5,n-o/5,4*o/5),e.addColorStop(0,"#111"),e.addColorStop(1,"#000")),this.beginPath(),this.fillStyle=e,this.arc(s-.5,n-.5,o-.5,0,2*Math.PI,!0),this.fill(),this.beginPath(),this.lineWidth=o/6,t.c==r.W?(this.strokeStyle="#999",this.arc(s+o/8,n+o/8,o/2,0,Math.PI/2,!1)):(this.strokeStyle="#ccc",this.arc(s-o/8,n-o/8,o/2,Math.PI,1.5*Math.PI)),this.stroke()}},shadow:h},GLOW:{stone:{draw:function(t,i){var e,s=i.getX(t.x),n=i.getY(t.y),o=i.stoneRadius;t.c==r.W?(e=this.createRadialGradient(s-2*o/5,n-2*o/5,o/3,s-o/5,n-o/5,8*o/5),e.addColorStop(0,"#fff"),e.addColorStop(1,"#666")):(e=this.createRadialGradient(s-2*o/5,n-2*o/5,1,s-o/5,n-o/5,3*o/5),e.addColorStop(0,"#555"),e.addColorStop(1,"#000")),this.beginPath(),this.fillStyle=e,this.arc(s-.5,n-.5,o-.5,0,2*Math.PI,!0),this.fill()}},shadow:h},MONO:{stone:{draw:function(t,i){var e=i.getX(t.x),s=i.getY(t.y),n=i.stoneRadius,o=i.lineWidth||1;this.fillStyle=t.c==r.W?"white":"black",this.beginPath(),this.arc(e,s,n-o,0,2*Math.PI,!0),this.fill(),this.lineWidth=o,this.strokeStyle="black",this.stroke()}}},CR:{stone:{draw:function(t,i){var e=i.getX(t.x),s=i.getY(t.y),n=i.stoneRadius;this.strokeStyle=t.c||a(i,t.x,t.y),this.lineWidth=t.lineWidth||i.lineWidth||1,this.beginPath(),this.arc(e-.5,s-.5,n/2,0,2*Math.PI,!0),this.stroke()}}},LB:{stone:{draw:function(t,i){var e=i.getX(t.x),s=i.getY(t.y),n=i.stoneRadius,o=t.font||i.font||"";this.fillStyle=i.obj_arr[t.x][t.y][0].c==r.W?"black":i.obj_arr[t.x][t.y][0].c==r.B?"white":"#1C1C1C",this.font=1==t.text.length?Math.round(1.5*n)+"px "+o:2==t.text.length?Math.round(1.2*n)+"px "+o:Math.round(n)+"px "+o,this.beginPath(),this.textBaseline="middle",this.textAlign="center",this.fillText(t.text,e,s,2*n)}},grid:{draw:function(t,i){if(!i.obj_arr[t.x][t.y][0].c&&!t._nodraw){var e=i.getX(t.x),s=i.getY(t.y),n=i.stoneRadius;this.clearRect(e-n,s-n,2*n,2*n)}},clear:function(t,i){i.obj_arr[t.x][t.y][0].c||(t._nodraw=!0,c(i,"grid"),delete t._nodraw)}}},SQ:{stone:{draw:function(t,i){var e=i.getX(t.x),s=i.getY(t.y),n=Math.round(i.stoneRadius);this.strokeStyle=t.c||a(i,t.x,t.y),this.lineWidth=t.lineWidth||i.lineWidth||1,this.beginPath(),this.rect(Math.round(e-n/2)-.5,Math.round(s-n/2)-.5,n,n),this.stroke()}}},TR:{stone:{draw:function(t,i){var e=i.getX(t.x),s=i.getY(t.y),n=i.stoneRadius;this.strokeStyle=t.c||a(i,t.x,t.y),this.lineWidth=t.lineWidth||i.lineWidth||1,this.beginPath(),this.moveTo(e-.5,s-.5-Math.round(n/2)),this.lineTo(Math.round(e-n/2)-.5,Math.round(s+n/3)+.5),this.lineTo(Math.round(e+n/2)+.5,Math.round(s+n/3)+.5),this.closePath(),this.stroke()}}},MA:{stone:{draw:function(t,i){var e=i.getX(t.x),s=i.getY(t.y),n=i.stoneRadius;this.strokeStyle=t.c||a(i,t.x,t.y),this.lineWidth=2*(t.lineWidth||i.lineWidth||1),this.beginPath(),this.moveTo(Math.round(e-n/2),Math.round(s-n/2)),this.lineTo(Math.round(e+n/2),Math.round(s+n/2)),this.moveTo(Math.round(e+n/2)-1,Math.round(s-n/2)),this.lineTo(Math.round(e-n/2)-1,Math.round(s+n/2)),this.stroke()}}},SL:{stone:{draw:function(t,i){var e=i.getX(t.x),s=i.getY(t.y),n=i.stoneRadius;this.fillStyle=t.c||a(i,t.x,t.y),this.beginPath(),this.rect(e-n/2,s-n/2,n,n),this.fill()}}},SM:{stone:{draw:function(t,i){var e=i.getX(t.x),s=i.getY(t.y),n=i.stoneRadius;this.strokeStyle=t.c||a(i,t.x,t.y),this.lineWidth=2*(t.lineWidth||i.lineWidth||1),this.beginPath(),this.arc(e-n/3,s-n/3,n/6,0,2*Math.PI,!0),this.stroke(),this.beginPath(),this.arc(e+n/3,s-n/3,n/6,0,2*Math.PI,!0),this.stroke(),this.beginPath(),this.moveTo(e-n/1.5,s),this.bezierCurveTo(e-n/1.5,s+n/2,e+n/1.5,s+n/2,e+n/1.5,s),this.stroke()}}},outline:{stone:{draw:function(t,i){this.globalAlpha=.3,t.stoneStyle?o.drawHandlers[t.stoneStyle].stone.draw.call(this,t,i):i.stoneHandler.stone.draw.call(this,t,i),this.globalAlpha=1}}},mini:{stone:{draw:function(t,i){i.stoneRadius=i.stoneRadius/2,t.stoneStyle?o.drawHandlers[t.stoneStyle].stone.draw.call(this,t,i):i.stoneHandler.stone.draw.call(this,t,i),i.stoneRadius=2*i.stoneRadius}}}},o.CanvasLayer=function(){this.element=document.createElement("canvas"),this.context=this.element.getContext("2d")},o.CanvasLayer.prototype={constructor:o.CanvasLayer,setDimensions:function(t,i){this.element.width=t,this.element.height=i},draw:function(){},clear:function(){this.context.clearRect(0,0,this.element.width,this.element.height)}},o.GridLayer=r.extendClass(o.CanvasLayer,function(){this["super"].call(this)}),o.GridLayer.prototype.draw=function(t){var i;this.context.beginPath(),this.context.lineWidth=1,this.context.strokeStyle="#000";var e=Math.round(t.left),s=Math.round(t.top),n=Math.round(t.fieldWidth*(t.size-1)),r=Math.round(t.fieldHeight*(t.size-1));this.context.strokeRect(e-.5,s-.5,n,r);for(var o=1;o<t.size-1;o++)i=Math.round(t.getX(o))-.5,this.context.moveTo(i,s),this.context.lineTo(i,s+r),i=Math.round(t.getY(o))-.5,this.context.moveTo(e,i),this.context.lineTo(e+n,i);if(this.context.stroke(),this.context.fillStyle="#000",t.starPoints[t.size])for(var h in t.starPoints[t.size])this.context.beginPath(),this.context.arc(t.getX(t.starPoints[t.size][h].x)-.5,t.getY(t.starPoints[t.size][h].y)-.5,t.starSize*(t.width/300+1),0,2*Math.PI,!0),this.context.fill()},o.ShadowLayer=r.extendClass(o.CanvasLayer,function(t){this["super"].call(this),this.shadowSize=t===i?1:t}),o.ShadowLayer.prototype.setDimensions=function(t,i){this["super"].prototype.setDimensions.call(this,t,i),this.context.setTransform(1,0,0,1,Math.round(this.shadowSize*t/300),Math.round(this.shadowSize*i/300))};var l=function(t,i){var e=i.getX(t.x),s=i.getY(t.y),n=i.stoneRadius;this.clearRect(e-n-.5,s-n-.5,2*n,2*n),this.clearRect(e-n-.5,s-n-.5,2*n,2*n)},u=function(){return 3*this.width/(4*(this.bx+1-this.tx)+2)-this.fieldWidth*this.tx},d=function(){return 3*this.height/(4*(this.by+1-this.ty)+2)-this.fieldHeight*this.ty},f=function(){return 4*this.width/(4*(this.bx+1-this.tx)+2)},p=function(){return 4*this.height/(4*(this.by+1-this.ty)+2)},g=function(t,i){var e;for(var s in this.obj_arr[t][i]){e=this.obj_arr[t][i][s].type?"string"==typeof this.obj_arr[t][i][s].type?o.drawHandlers[this.obj_arr[t][i][s].type]:this.obj_arr[t][i][s].type:this.stoneHandler;for(var n in e)e[n].clear?e[n].clear.call(this[n].context,this.obj_arr[t][i][s],this):l.call(this[n].context,this.obj_arr[t][i][s],this)}},v=function(t,i){var e;for(var s in this.obj_arr[t][i]){e=this.obj_arr[t][i][s].type?"string"==typeof this.obj_arr[t][i][s].type?o.drawHandlers[this.obj_arr[t][i][s].type]:this.obj_arr[t][i][s].type:this.stoneHandler;for(var n in e)e[n].draw.call(this[n].context,this.obj_arr[t][i][s],this)}},y=function(t){for(var i,e,s=0,n=0,r=this.grid.element;r&&"BODY"!=r.tagName;)s+=r.offsetTop,n+=r.offsetLeft,r=r.offsetParent;return i=Math.round((t.pageX-n-this.left)/this.fieldWidth),e=Math.round((t.pageY-s-this.top)/this.fieldHeight),{x:i>=this.size?-1:i,y:e>=this.size?-1:e}},m=function(){this.element.style.width=this.width+"px",this.element.style.height=this.height+"px",this.stoneRadius=this.stoneSize*Math.min(this.fieldWidth,this.fieldHeight)/2;for(var t in this.layers)this.layers[t].setDimensions(this.width,this.height)};o.prototype={constructor:o,init:function(){this.obj_arr=[];for(var t=0;t<this.size;t++){this.obj_arr[t]=[];for(var i=0;i<this.size;i++)this.obj_arr[t][i]=[]}this.obj_list=[],this.layers=[],this.listeners=[],this.element=document.createElement("div"),this.element.className="wgo-board",this.background&&("#"==this.background[0]?this.element.style.backgroundColor=this.background:this.element.style.backgroundImage="url('"+this.background+"')"),this.grid=new o.GridLayer,this.shadow=new o.ShadowLayer(this.shadowSize),this.stone=new o.CanvasLayer,this.addLayer(this.grid,100),this.addLayer(this.shadow,200),this.addLayer(this.stone,300)},setWidth:function(t){this.width=t,this.fieldHeight=this.fieldWidth=f.call(this),this.left=u.call(this),this.height=(this.by-this.ty+1.5)*this.fieldHeight,this.top=d.call(this),m.call(this),this.redraw()},setHeight:function(t){this.height=t,this.fieldWidth=this.fieldHeight=p.call(this),this.top=d.call(this),this.width=(this.bx-this.tx+1.5)*this.fieldWidth,this.left=u.call(this),m.call(this),this.redraw()},setDimensions:function(t,i){this.width=t||this.width,this.height=i||this.height,this.fieldWidth=f.call(this),this.fieldHeight=p.call(this),this.left=u.call(this),this.top=d.call(this),m.call(this),this.redraw()},getSection:function(){return this.section},setSection:function(t,i,e,s){this.section="object"==typeof t?t:{top:t,right:i,bottom:e,left:s},this.tx=this.section.left,this.ty=this.section.top,this.bx=this.size-1-this.section.right,this.by=this.size-1-this.section.bottom,this.setDimensions()},setSize:function(t){var t=t||19;if(t!=this.size){this.size=t,this.obj_arr=[];for(var i=0;i<this.size;i++){this.obj_arr[i]=[];for(var e=0;e<this.size;e++)this.obj_arr[i][e]=[]}this.bx=this.size-1-this.section.right,this.by=this.size-1-this.section.bottom,this.setDimensions()}},redraw:function(){this.grid.clear(),this.stone.clear(),this.shadow.clear(),this.grid.draw(this);for(var t=0;t<this.size;t++)for(var i=0;i<this.size;i++)v.call(this,t,i);for(var e in this.obj_list){var s=this.obj_list[e].handler;for(var n in s)s[n].draw.call(this[n].context,this.obj_list[e].args,this)}},getX:function(t){return this.left+t*this.fieldWidth},getY:function(t){return this.top+t*this.fieldHeight},addLayer:function(t,i){t.element.style.position="absolute",t.element.style.zIndex=i,t.setDimensions(this.width,this.height),this.element.appendChild(t.element),this.layers.push(t)},removeLayer:function(t){var i=this.layers.indexOf(t);i>=0&&(this.layers.splice(i,1),this.element.removeChild(t.element))},update:function(t){if(t.remove&&"all"==t.remove)this.removeAllObjects();else if(t.remove)for(var i in t.remove)this.removeObject(t.remove[i]);if(t.add)for(var i in t.add)this.addObject(t.add[i])},addObject:function(t){if(t.constructor!=Array){g.call(this,t.x,t.y);for(var i in this.obj_arr[t.x][t.y])if(this.obj_arr[t.x][t.y][i].type==t.type)return this.obj_arr[t.x][t.y][i]=t,void v.call(this,t.x,t.y);t.type?this.obj_arr[t.x][t.y].push(t):this.obj_arr[t.x][t.y].unshift(t),v.call(this,t.x,t.y)}else for(var i in t)this.addObject(t[i])},removeObject:function(t){if(t.constructor!=Array){for(var e,s=0;s<this.obj_arr[t.x][t.y].length;s++)if(this.obj_arr[t.x][t.y][s].type==t.type){e=s;break}e!==i&&(g.call(this,t.x,t.y),this.obj_arr[t.x][t.y].splice(e,1),v.call(this,t.x,t.y))}else for(var n in t)this.removeObject(t[n])},removeObjectsAt:function(t,i){this.obj_arr[t][i].length&&(g.call(this,t,i),this.obj_arr[t][i]=[])},removeAllObjects:function(){this.obj_arr=[];for(var t=0;t<this.size;t++){this.obj_arr[t]=[];for(var i=0;i<this.size;i++)this.obj_arr[t][i]=[]}this.redraw()},addCustomObject:function(t,i){this.obj_list.push({handler:t,args:i}),this.redraw()},removeCustomObject:function(t,i){for(var e in this.obj_list)if(this.obj_list[e].handler==t&&this.obj_list[e].args==i)return delete this.obj_list[e],this.redraw(),!0;return!1},addEventListener:function(t,i){var e=this,s={type:t,callback:i,handleEvent:function(t){var s=y.call(e,t);i(s.x,s.y,t)}};this.element.addEventListener(t,s,!0),this.listeners.push(s)},removeEventListener:function(t,i){for(var e in this.listeners)if(this.listeners[e].type==t&&this.listeners[e].callback==i)return this.element.removeEventListener(this.listeners[e].type,this.listeners[e],!0),delete this.listeners[e],!0;return!1},getState:function(){return{objects:r.clone(this.obj_arr),custom:r.clone(this.obj_list)}},restoreState:function(t){this.obj_arr=t.objects||this.obj_arr,this.obj_list=t.custom||this.obj_list,this.redraw()}},o["default"]={size:19,width:0,height:0,font:"Calibri",lineWidth:1,starPoints:{19:[{x:3,y:3},{x:9,y:3},{x:15,y:3},{x:3,y:9},{x:9,y:9},{x:15,y:9},{x:3,y:15},{x:9,y:15},{x:15,y:15}],13:[{x:3,y:3},{x:9,y:3},{x:3,y:9},{x:9,y:9}],9:[{x:4,y:4}]},stoneHandler:o.drawHandlers.NORMAL,starSize:1,shadowSize:1,stoneSize:1,section:{top:0,right:0,bottom:0,left:0},background:r.DIR+"wood1.jpg"},r.Board=o;var b=function(t){this.size=t,this.schema=[];for(var i=0;t*t>i;i++)this.schema[i]=0};b.prototype={constructor:r.Position,get:function(t,e){return 0>t||0>e||t>=this.size||e>=this.size?i:this.schema[t*this.size+e]},set:function(t,i,e){return this.schema[t*this.size+i]=e,this},clear:function(){for(var t=0;t<this.size*this.size;t++)this.schema[t]=0;return this},clone:function(){var t=new b(this.size);return t.schema=this.schema.slice(0),t}},r.Position=b;var w=function(t,e){this.size=t||19,this.repeating=e===i?"KO":e,this.stack=[],this.stack[0]=new b(t),this.stack[0].capCount={black:0,white:0},this.turn=r.B,Object.defineProperty(this,"position",{get:function(){return this.stack[this.stack.length-1]},set:function(t){this[this.stack.length-1]=t}})},x=function(t,i,e,s,n){e>=0&&e<t.size&&s>=0&&s<t.size&&t.get(e,s)==n&&(t.set(e,s,0),i.push({x:e,y:s}),x(t,i,e,s-1,n),x(t,i,e,s+1,n),x(t,i,e-1,s,n),x(t,i,e+1,s,n))},k=function(t,i,e,s,n){return 0>e||e>=t.size||0>s||s>=t.size?!0:0==t.get(e,s)?!1:1==i.get(e,s)||t.get(e,s)==-n?!0:(i.set(e,s,!0),k(t,i,e,s-1,n)&&k(t,i,e,s+1,n)&&k(t,i,e-1,s,n)&&k(t,i,e+1,s,n))},S=function(t,i,e,s){var n=[];if(i>=0&&i<t.size&&e>=0&&e<t.size&&t.get(i,e)==s){var r=new b(t.size);k(t,r,i,e,s)&&x(t,n,i,e,s)}return n},j=function(t,i,e){var s,n;if("KO"==this.repeating&&this.stack.length-2>=0)n=this.stack.length-2;else{if("ALL"!=this.repeating)return!0;n=0}for(var r=this.stack.length-2;r>=n;r--)if(this.stack[r].get(i,e)==t.get(i,e)){s=!0;for(var o=0;o<this.size*this.size;o++)if(this.stack[r].schema[o]!=t.schema[o]){s=!1;break}if(s)return!1}return!0};w.prototype={constructor:w,getPosition:function(){return this.stack[this.stack.length-1]},play:function(t,i,e,s){if(!this.isOnBoard(t,i))return 1;if(0!=this.position.get(t,i))return 2;e||(e=this.turn);var n=this.position.clone();n.set(t,i,e);var o=S(n,t-1,i,-e).concat(S(n,t+1,i,-e),S(n,t,i-1,-e),S(n,t,i+1,-e));if(!o.length){var h=new b(this.size);if(k(n,h,t,i,e))return 3}return this.repeating&&!j.call(this,n,t,i)?4:s?!1:(n.color=e,n.capCount={black:this.position.capCount.black,white:this.position.capCount.white},e==r.B?n.capCount.black+=o.length:n.capCount.white+=o.length,this.pushPosition(n),this.turn=-e,o)},pass:function(t){this.turn=t?-t:-this.turn,this.pushPosition(),this.position.color=-this.position.color},isValid:function(t,i,e){return"number"!=typeof this.play(t,i,e,!0)},isOnBoard:function(t,i){return t>=0&&i>=0&&t<this.size&&i<this.size},addStone:function(t,i,e){return this.isOnBoard(t,i)&&0==this.position.get(t,i)?(this.position.set(t,i,e||0),!0):!1},removeStone:function(t,i){return this.isOnBoard(t,i)&&0!=this.position.get(t,i)?(this.position.set(t,i,0),!0):!1},setStone:function(t,i,e){return this.isOnBoard(t,i)?(this.position.set(t,i,e||0),!0):!1},getStone:function(t,i){return this.isOnBoard(t,i)?this.position.get(t,i):0},pushPosition:function(t){if(!t){var t=this.position.clone();t.capCount={black:this.position.capCount.black,white:this.position.capCount.white},t.color=this.position.color}return this.stack.push(t),this},popPosition:function(){var t=null;return this.stack.length>0&&(t=this.stack.pop(),this.turn=0==this.stack.length?r.B:this.position.color?-this.position.color:-this.turn),t},firstPosition:function(){return this.stack=[],this.stack[0]=new b(this.size),this.stack[0].capCount={black:0,white:0},this.turn=r.B,this},getCaptureCount:function(t){return t==r.B?this.position.capCount.black:this.position.capCount.white},validatePosition:function(){for(var t,i,e=0,s=0,n=[],o=this.position.clone(),h=0;h<this.size;h++)for(var a=0;a<this.size;a++)t=this.position.get(h,a),t&&(i=n.length,n=n.concat(S(o,h-1,a,-t),S(o,h+1,a,-t),S(o,h,a-1,-t),S(o,h,a+1,-t)),t==r.B?s+=n-i:e+=n-i);return this.position.capCount.black+=s,this.position.capCount.white+=e,this.position.schema=o.schema,n}},r.Game=w,t.WGo=r}(window),function(t,i){"use strict";var e=function(t){var i=new l(JSON.parse(JSON.stringify(t.getProperties())));for(var s in t.children)i.appendChild(e(t.children[s]));return i},s=function(t,e){var n;if(e[t]!==i)return e[t];for(var r in e.children)if(n=s(t,e.children[r]))return n;return!1},n=function(t,i){if(t.push(JSON.parse(JSON.stringify(i.getProperties()))),i.children.length>1){for(var e=[],s=0;s<i.children.length;s++){var r=[];n(r,i.children[s]),e.push(r)}t.push(e)}else i.children.length&&n(t,i.children[0])},r=function(t,i){for(var e,s=i,n=1;n<t.length;n++)if(t[n].constructor==Array)for(var o=0;o<t[n].length;o++)e=new l(t[n][o][0]),s.appendChild(e),r(t[n][o],e);else e=new l(t[n]),s.insertAfter(e),s=e},o=function(){this.size=19,this.info={},this.root=new l,this.nodeCount=0,this.propertyCount=0};o.prototype={constructor:o,clone:function(){var t=new o;return t.size=this.size,t.info=JSON.parse(JSON.stringify(this.info)),t.root=e(this.root),t.nodeCount=this.nodeCount,t.propertyCount=this.propertyCount,t},hasComments:function(){return!!s("comment",this.root)}},o.fromSgf=function(i){return t.SGF.parse(i)},o.fromJGO=function(t){var i="string"==typeof t?JSON.parse(t):t,e=new o;return e.info=JSON.parse(JSON.stringify(i.info)),e.size=i.size,e.nodeCount=i.nodeCount,e.propertyCount=i.propertyCount,e.root=new l(i.game[0]),r(i.game,e.root),e},o.prototype.toSgf=function(){},o.prototype.toJGO=function(t){var i={};return i.size=this.size,i.info=JSON.parse(JSON.stringify(this.info)),i.nodeCount=this.nodeCount,i.propertyCount=this.propertyCount,i.game=[],n(i.game,this.root),t?JSON.stringify(i):i};var h=function(i){var e;return i.name?(e=t.filterHTML(i.name),i.rank&&(e+=" ("+t.filterHTML(i.rank)+")"),i.team&&(e+=", "+t.filterHTML(i.team))):(i.team&&(e=t.filterHTML(i.team)),i.rank&&(e+=" ("+t.filterHTML(i.rank)+")")),e};o.infoFormatters={black:h,white:h,TM:function(i){if(0==i)return t.t("none");var e,s=Math.floor(i/60);return 1==s?e="1 "+t.t("minute"):s>1&&(e=s+" "+t.t("minutes")),s=i%60,1==s?e+=" 1 "+t.t("second"):s>1&&(e+=" "+s+" "+t.t("seconds")),e},RE:function(i){return'<a href="javascript: void(0)" onclick="this.parentNode.innerHTML = \''+t.filterHTML(i)+'\'" title="'+t.t("res-show-tip")+'">'+t.t("show")+"</a>"}},o.infoList=["black","white","AN","CP","DT","EV","GN","GC","ON","OT","RE","RO","RU","SO","TM","PC","KM"],t.Kifu=o;var a=function(t,i,e){for(var s=0;s<t.length;s++)if(t[s].x==i.x&&t[s].y==i.y)return void(t[s][e]=i[e]);t.push(i)},c=function(t,i){t||remove;for(var e=0;e<t.length;e++)if(t[e].x==i.x&&t[e].y==i.y)return void t.splice(e,1)},l=function(t,i){if(this.parent=i||null,this.children=[],t)for(var e in t)this[e]=t[e]};l.prototype={constructor:l,getChild:function(t){var i=t||0;return this.children[i]?this.children[i]:null},addSetup:function(t){return this.setup=this.setup||[],a(this.setup,t,"c"),this},removeSetup:function(t){return c(this.setup,t),this},addMarkup:function(t){return this.markup=this.markup||[],a(this.markup,t,"type"),this},removeMarkup:function(t){return c(this.markup,t),this},remove:function(){var t=this.parent;if(!t)throw new Exception("Root node cannot be removed");for(var i in t.children)if(t.children[i]==this){t.children.splice(i,1);break}return t.children=t.children.concat(this.children),this.parent=null,t},insertAfter:function(t){return t.children=t.children.concat(this.children),t.parent=this,this.children=[t],t},appendChild:function(t){return t.parent=this,this.children.push(t),t},getProperties:function(){var t={};for(var i in this)this.hasOwnProperty(i)&&"children"!=i&&"parent"!=i&&(t[i]=this[i]);return t}},t.KNode=l;var u=function(t,i){for(var e=t.size,s=[],n=[],r=0;e*e>r;r++)t.schema[r]&&!i.schema[r]?n.push({x:Math.floor(r/e),y:r%e}):t.schema[r]!=i.schema[r]&&s.push({x:Math.floor(r/e),y:r%e,c:i.schema[r]});return{add:s,remove:n}},d=function(i,e){this.kifu=i,this.node=this.kifu.root,this.game=new t.Game(this.kifu.size),this.path={m:0},this.change=g(this.game,this.node,!0),this.kifu.info.HA&&this.kifu.info.HA>1&&(this.game.turn=t.W),this.rememberPath=e?!0:!1},f=function(t,i){var e,s=[];for(var n in t){e=!0;for(var r in i)if(t[n].x==i[r].x&&t[n].y==i[r].y){e=!1;break}e&&s.push(t[n])}return s},p=function(t,i){t.add=f(t.add,i.remove).concat(i.add),t.remove=f(t.remove,i.add).concat(i.remove)},g=function(t,e,s){if(e.parent&&(e.parent._last_selected=e.parent.children.indexOf(e)),e.move!=i){if(e.move.pass)return t.pass(e.move.c),{add:[],remove:[]};var n=t.play(e.move.x,e.move.y,e.move.c);if("number"==typeof n)throw new b(n,e);return{add:[e.move],remove:n}}if(e.setup!=i){s||t.pushPosition();var r=[],o=[];for(var h in e.setup)e.setup[h].c?(t.addStone(e.setup[h].x,e.setup[h].y,e.setup[h].c),r.push(e.setup[h])):(t.removeStone(e.setup[h].x,e.setup[h].y),o.push(e.setup[h]));return e.turn&&(t.turn=e.turn),{add:r,remove:o}}return s||t.pushPosition(),{add:[],remove:[]}},v=function(t){t===i&&this.rememberPath&&(t=this.node._last_selected),t=t||0;var e=this.node.children[t];if(!e)return!1;var s=g(this.game,e);return this.path.m++,this.node.children.length>1&&(this.path[this.path.m]=t),this.node=e,s},y=function(){return this.node.parent?(this.node=this.node.parent,this.game.popPosition(),this.path.m--,this.path[this.path.m]!==i&&delete this.path[this.path.m],!0):!1},m=function(){this.game.firstPosition(),this.node=this.kifu.root,this.path={m:0},this.change=g(this.game,this.node,!0),this.kifu.info.HA&&this.kifu.info.HA>1&&(this.game.turn=t.W)};d.prototype={constructor:d,next:function(t){return this.change=v.call(this,t),this},last:function(){var t;for(this.change={add:[],remove:[]};t=v.call(this);)p(this.change,t);return this},previous:function(){var t=this.game.getPosition();return y.call(this),this.change=u(t,this.game.getPosition()),this},first:function(){var t=this.game.getPosition();return m.call(this),this.change=u(t,this.game.getPosition()),this},goTo:function(t){if(t===i)return this;var e=this.game.getPosition();m.call(this);for(var s=0;s<t.m&&v.call(this,t[s+1]);s++);return this.change=u(e,this.game.getPosition()),this},previousFork:function(){for(var t=this.game.getPosition();y.call(this)&&1==this.node.children.length;);return this.change=u(t,this.game.getPosition()),this},getPosition:function(){return this.game.getPosition()}},t.KifuReader=d;var b=function(e,s){if(this.name="InvalidMoveError",this.message="Invalid move in kifu detected. ",this.message+=s.move&&s.move.c!==i&&s.move.x!==i&&s.move.y!==i?"Trying to play "+(s.move.c==t.WHITE?"white":"black")+" move on "+String.fromCharCode(s.move.x+65)+(19-s.move.y):"Move object doesn't contain arbitrary attributes.",e)switch(e){case 1:this.message+=", but these coordinates are not on board.";break;case 2:this.message+=", but there already is a stone.";break;case 3:this.message+=", but this move is a suicide.";case 4:this.message+=", but this position already occured."}else this.message+="."};b.prototype=new Error,b.prototype.constructor=b,t.InvalidMoveError=b,t.i18n.en.show="show",t.i18n.en["res-show-tip"]="Click to show result."}(WGo),function(t){t.SGF={};var i=function(t,i){return t.charCodeAt(i)-97},e=function(t,i,e,s,n,r){var o=r==i?"black":"white";e.info[o]=e.info[o]||{},e.info[o][t]=n[0]},s=t.SGF.properties={};s.B=s.W=function(e,s,n,r){s.move=!n[0]||e.size<=19&&"tt"==n[0]?{pass:!0,c:"B"==r?t.B:t.W}:{x:i(n[0],0),y:i(n[0],1),c:"B"==r?t.B:t.W}},s.AB=s.AW=function(e,s,n,r){for(var o in n)s.addSetup({x:i(n[o],0),y:i(n[o],1),c:"AB"==r?t.B:t.W})},s.AE=function(t,e,s){for(var n in s)e.addSetup({x:i(s[n],0),y:i(s[n],1)})},s.PL=function(i,e,s){e.turn="b"==s[0]?t.B:t.W},s.C=function(t,i,e){i.comment=e.join()},s.LB=function(t,e,s){for(var n in s)e.addMarkup({x:i(s[n],0),y:i(s[n],1),type:"LB",text:s[n].substr(3)})},s.CR=s.SQ=s.TR=s.SL=s.MA=function(t,e,s,n){for(var r in s)e.addMarkup({x:i(s[r],0),y:i(s[r],1),type:n})},s.SZ=function(t,i,e){t.size=parseInt(e[0])},s.BR=s.WR=e.bind(this,"rank","BR"),s.PB=s.PW=e.bind(this,"name","PB"),s.BT=s.WT=e.bind(this,"team","BT"),s.TM=function(t,i,e,s){t.info[s]=e[0],i.BL=e[0],i.WL=e[0]};var n=/\(|\)|(;(\s*[A-Z]+\s*((\[\])|(\[(.|\s)*?([^\\]\])))+)*)/g,r=/[A-Z]+\s*((\[\])|(\[(.|\s)*?([^\\]\])))+/g,o=/[A-Z]+/,h=/(\[\])|(\[(.|\s)*?([^\\]\]))/g;t.SGF.parse=function(i){var e,s,a,c,l=[],u=new t.Kifu,d=null;e=i.match(n);for(var f in e)if("("==e[f])l.push(d);else if(")"==e[f])d=l.pop();else{d&&u.nodeCount++,d=d?d.appendChild(new t.KNode):u.root,s=e[f].match(r),u.propertyCount+=s.length;for(var p in s){c=o.exec(s[p])[0],a=s[p].match(h);for(var g in a)a[g]=a[g].substring(1,a[g].length-1).replace(/\\(?!\\)/g,"");t.SGF.properties[c]?t.SGF.properties[c](u,d,a,c):(a.length<=1&&(a=a[0]),d.parent?d[c]=a:u.info[c]=a)}}return u}}(WGo);